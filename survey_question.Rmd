---
title: "De-list endangered salmon and steelhead of the Lower Columbia River Basin"
subsubtitle: "Effectiveness of guided site visits"
author: "Minnie"
output: beamer_presentation
header-includes:
- \usepackage{caption}
- \captionsetup[figure]{labelformat=empty}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
```

```{r load, echo=FALSE}
# Load the required packages
library(DeclareDesign)
library(knitr)
library(ggplot2)
library(grid)
library(gridExtra)
library(dplyr)
library(kableExtra)
```

## Measurement Goal & Measure

**Goal**: Test effectiveness of guided site visits in increasing program awareness and making good impressions on visitors.

" Please rate your experience today with X guide on the following (Likert) scale:"

a. Very Satisfied
b. (Somewhat) Satisfied
c. Neutral
d. (Somewhat) Dissatisfied
e. Very Dissatisfied

*Note: present in horizontal line to prevent order bias

## Source & Rationale & Unit

*Source*: Each visitor will be asked to complete the survey following the guided site visit.

*Rationale*: The site visits are provided in order to provide potential donors and collaborators with first-hand experience of the program elements and impacts. The assumption we are testing is whether site visits truly increase visitor knowledge and leave guests with a positive impression. This measure of visit satisfaction will later be correlated with actual future engagement.

*Unit*: individual survey respondent


## Responsibility & Frequency

*Responsibility*: Staff member (possibly administrator?) other than the tour guide should administer this partially anonymous survey. Guests should not feel uncomfortable providing honest feedback, but it will be helpful to include some identifying information that will allow other measures to be correlated with tour satisfaction.

*Frequency*: Every individual should be asked to take the survey, since each could represent a different donor organization. Additionally, if there are multiple tour guides, it would be important to determine which/whose strategy is most effective. 


## Declaring the population

Administrative data shows that 20 tours are led throughout the year, 10 individuals are on each tour, and 9/10 of individuals agree to take the survey, resulting in 180 responses each year.

Organizations       Visitors per tour       Surveys Completed
-----------        ------------------      ------------------
Donor               8                       8
Non-Donor           2                       1


## Target Population & Challenges

*Target Population*: all [visitors who represent] potential donors or collaborators

*Challenge of drawing a representative sample*: we can only survey individuals who physically visit the site. Donors already committed may send a disproportionate number of visitors to demonstrate their committment, while donors who do not visit are left out (response bias). In addition, some individuals may refuse to complete the survey, and this could be correlated with their level of (dis)satisfaction with the visit - this would bias the survey towards positive feedback (sampling bias).

*Sampling procedure*: Request every visitor complete the survey at the end of their site visit.

## DeclareDesign()

```{r pop}
set.seed(228)
#Minnie: Create a population of 10 visitors, 8 are donors. Then use whether or not visitors are donors to determine their level of satisfaction??? This means that visitors' satisfaction is directly correlated to whether or not they are donors.

population <- declare_population(
  visitors = add_level(N=10,
                       donor = sample(c(rep(0,2),rep(1,8))),
     satisfied=correlate(given = donor, rho = 0.9,
                         draw_binary, prob = 0.5)
))

#Minnie: What are draw_binary and prob doing?

#Minnie: Add clustering:there are 3 tour guides
population2 <- declare_population(
  guide = add_level(N=3, #number of tour guides
    w=runif(length(guide), min=-0.3, max=0.3)), #what are the min and max?
  individual = add_level(N=10, #visitors per site visit
    y=runif(length(individual), min=-0.3, max=0.3), #what are the min and max?
    prob=case_when(w+y<0 ~ 0,
                   w+y>1 ~ 1,
                   w+y>=0 & w+y<=1 ~ w+y),
     satisfied=draw_binary(prob = prob)))

population3 <- declare_population(
  guide = add_level(N=3,
         baseline=c(0.7,0.8,0.9)),
  individual = add_level(N=c(10,10,10),
                         satisfied=draw_binary(baseline)))


pop <- population()

kable(table(pop$donor,pop$satisfied)) %>% 
  add_header_above(c("donor"=1,"satisfied"=2))

my_estimand <- declare_estimands(mean(satisfied),
                                 label = "Ybar")
```

## Declaring response bias

```{r diff-reporting, echo=FALSE}

reporting <- declare_assignment(blocks=donor,
                  assignment_variable = "A", 
                  block_prob=c(0.5,1.0))

#Minnie: Donors will all complete the survey, half of non-donors will refuse to complete it --> donors are more likely to  be "reporters"

#Minnie: no stratification in this example?

pop <- reporting(pop)
```

```{r resp-tab, echo=FALSE}
table(pop$donor,pop$A)
```

## DeclareDesign()

```{r diagnosis, cache=TRUE}

answer <- declare_estimator(
  handler = tidy_estimator(strata_weighted_mean), #PH: this is the custom function we wrote in the chunk above.
  estimand = my_estimand) #PH: 'my_estimand' is the true population mean of knowledge. We happen to know this in this case (b/c we faked the data), but you'll have to make an educated guess about what this is in practice. Often, you see people designing M&E programs cite research to take a stab at the actual value of the estimand.

design <- population + my_estimand + reporting
diagnosis <- diagnose_design(design, sims = 1000)

diagnosis$diagnosands_df[,c(4,5,12,14)] %>%
  kable()

```



